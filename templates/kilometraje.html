{% extends "base.html" %}

{% block title %}Registro de Kilometraje{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ðŸš— Kilometraje Diario</h2>
    
    <section class="card p-4 shadow-sm mb-4">
        <h3>Estado de la Jornada</h3>
        <!-- ID ÃšNICO: fecha_km - El JS ya estÃ¡ escuchando este ID -->
        <label for="fecha_km">Fecha:</label>
        <input type="date" name="fecha_km" id="fecha_km" value="{{ today_date }}" class="form-control" required>
        
        <div id="km-state-container" class="mt-4">
            Cargando estado del kilometraje...
        </div>
    </section>

    <!-- FORMULARIO DE INICIO -->
    <section id="km-start-form" class="card p-4 shadow-sm mb-4" style="display:none;">
        <h3>Registrar Inicio de Jornada</h3>
        <form>
            <label for="km_value_start">Kilometraje Actual (Inicio):</label>
            <input type="number" name="km_value" id="km_value_start" class="form-control" required min="0">
            
            <label for="notas_start">Notas de inicio (Opcional):</label>
            <input type="text" name="notas" id="notas_start" class="form-control">
            
            <button type="submit" class="btn mt-3" style="background-color: #007bff;">Iniciar KM</button>
        </form>
    </section>
    
    <!-- FORMULARIO DE FIN -->
    <section id="km-end-form" class="card p-4 shadow-sm mb-4" style="display:none;">
        <h3>Registrar Fin de Jornada</h3>
        <form>
            <label for="km_value_end">Kilometraje Actual (Fin):</label>
            <input type="number" name="km_value" id="km_value_end" class="form-control" required>
            
            <button type="submit" class="btn mt-3" style="background-color: #dc3545;">Finalizar KM</button>
        </form>
    </section>

    <hr>

    <section class="card p-4 shadow-sm">
        <h3>Resumen de Productividad Diaria</h3>
        <p class="text-muted">Calcula el ingreso neto y el valor por kilÃ³metro recorrido para el dÃ­a seleccionado, basado en Viajes y Gastos.</p>
        
        <!-- Este botÃ³n se usa para forzar el recÃ¡lculo y carga el resumen -->
        <button id="calculate-summary-btn" class="btn" style="background-color: #28a745;">
            Generar Resumen
        </button>
        
        <div id="summary-results" class="mt-4">
            <p>Cargando resumen del dÃ­a...</p>
        </div>
    </section>

</div>
{% endblock %}
